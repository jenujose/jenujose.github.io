<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-138306519-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>Cloud &amp; Security Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Cloud &amp; Security Blog">
<meta property="og:url" content="https://jenujose.github.io/index.html">
<meta property="og:site_name" content="Cloud &amp; Security Blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cloud &amp; Security Blog">
<meta name="twitter:creator" content="@jenu">
  
    <link rel="alternate" href="/atom.xml" title="Cloud &amp; Security Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Cloud &amp; Security Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://jenujose.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Exploring-Microsoft-Tunnel-Part-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/03/11/Exploring-Microsoft-Tunnel-Part-3/" class="article-date">
  <time datetime="2021-03-11T16:44:19.000Z" itemprop="datePublished">2021-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/11/Exploring-Microsoft-Tunnel-Part-3/">Exploring Microsoft Tunnel (Part 3)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Over the last two blog posts, we went over some of the pre-requisites and configuration required to setup Microsoft Tunnel. In this post, we will show the solution in action.</p>
<p>The sequence of events will be as follows</p>
<ul>
<li>Launch of iOS App that is tied to the MS Tunnel VPN (Once it’s launched you will see the VPN icon show up on the top right side of the phone.)</li>
<li>MS Tunnel established in the background </li>
<li>Using iOS app to access resources on the corporate network or in my case, home network.</li>
<li>Microsoft Tunnel is a separate app which is used as the interface to prompt for modern authentication. You will have to occasionally re-authenticate based on conditional access policies, timeout settings, etc.</li>
</ul>
<iframe width="560" height="315" src="https://www.youtube.com/embed/1grg97l3zbU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://jenujose.github.io/2021/03/11/Exploring-Microsoft-Tunnel-Part-3/" data-id="ckmzmmytx000d0oup2wuilttq" class="article-share-link">Share</a>
      
        <a href="https://jenujose.github.io/2021/03/11/Exploring-Microsoft-Tunnel-Part-3/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Exploring-Microsoft-Tunnel-Part-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/01/18/Exploring-Microsoft-Tunnel-Part-2/" class="article-date">
  <time datetime="2021-01-18T14:45:49.000Z" itemprop="datePublished">2021-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/01/18/Exploring-Microsoft-Tunnel-Part-2/">Exploring Microsoft Tunnel (Part 2)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In Part 1, we looked at some of the pre-requisites and installation of the Microsoft Tunnel. In this post, we will look at the Intune side. In part 3, we will go over the solution in action as well as ways to troubleshoot any issues.</p>
<h2 id="Intune-Server-and-Site-Configuration"><a href="#Intune-Server-and-Site-Configuration" class="headerlink" title="Intune Server and Site Configuration"></a>Intune Server and Site Configuration</h2><p>On the Intune side, you have to create a Server Configuration and Site Configuration. </p>
<p><code>Server Configuration - Defines DNS servers, split tunneling and server port information.</code></p>
<ul>
<li>IP Address Range - Defines the ip addresses reserved for clients when connecting to MS Tunnel VPN</li>
<li>DNS Servers - Defines DNS servers to be used when connected to MS Tunnel VPN</li>
<li>Split Tunneling - Defines subnets where the client will route traffic through MS Tunnel VPN</li>
<li>Server Port - Defines port to connect to the server</li>
</ul>
<p><img src="./images/2021/../../../images/2021/January/2020-11-30_20h40_00.png" alt="Server Configuration"></p>
<ul>
<li>Public IP address or FQDN - Defines the public ip address or DNS name of the server.</li>
<li>Server Configuration - Select a previously defined server configuration.</li>
</ul>
<p><code>Site Configuration - Defines the public IP address as well as server configuration.</code></p>
<p><img src="./images/2021/../../../images/2021/January/2020-11-30_20h40_48.png" alt="Site Configuration"></p>
<p><code>Server Configuration  - Is where you go to download the installer script. Once the script is run, this section will highlight the servers that are configured.</code> </p>
<p>The file is a bash script that runs a function to configure the server.</p>
<h2 id="Run-the-tunnel-setup"><a href="#Run-the-tunnel-setup" class="headerlink" title="Run the tunnel setup"></a>Run the tunnel setup</h2><p>Before the setup can be run, the PFX file needs to be copied to MStunnel directory<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://aka.ms/microsofttunneldownload -O mstunnel-setup</span><br><span class="line">sudo ./mstunnel-setup</span><br></pre></td></tr></table></figure></p>
<h2 id="Intune-Client-Configuration"><a href="#Intune-Client-Configuration" class="headerlink" title="Intune Client Configuration"></a>Intune Client Configuration</h2><p>Also on the Intune side, two configuration profiles were created to deploy the root and trusted CA certs to the mobile device.</p>
<p>A VPN profile was deployed as well with the Microsoft tunnel. The connection type was set to Microsoft Tunnel.<br><img src="./images/2021/../../../images/2021/January/2021-01-18_14h03_01.png" alt="VPN Configuration"></p>
<p>Lastly, the per-app VPN needs to be associated at the app deployment level. In my case, the app I wanted the on-demand VPN for was configured to use my MSTunnel configuration policy.</p>
<p><img src="./images/2021/../../../images/2021/January/2021-01-18_14h07_29.png" alt="App Configuration"></p>
<p>The Microsoft Tunnel App also needs to be deployed to the clients as well. This app is used to connect to the VPN and also to enforce conditional acccess rules (2FA for example). In the next and last part of this blog, we will go over the solution end to end.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jenujose.github.io/2021/01/18/Exploring-Microsoft-Tunnel-Part-2/" data-id="ckmzmmytr00050oupxoewku2j" class="article-share-link">Share</a>
      
        <a href="https://jenujose.github.io/2021/01/18/Exploring-Microsoft-Tunnel-Part-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-#Troubleshooting" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/01/13/#Troubleshooting/" class="article-date">
  <time datetime="2021-01-14T03:28:59.016Z" itemprop="datePublished">2021-01-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#Troubleshooting<br>Initially when I had the solution installed and configured, I could never get the tunnel to connect because my certificate request did not contain the DNS name in the CN field. Instead, I accidentally placed it as an alternate name in the certificate. To troubleshoot this the following commands can be run diagnose any issues as well as keep an eye on the tunnel backend.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">journalctl -t mstunnel_monitor -f</span><br><span class="line">journalctl -t mstunnel-agent -f</span><br><span class="line">journalctl -t ocserv -f</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jenujose.github.io/2021/01/13/#Troubleshooting/" data-id="ckmzmmytn00020oup9c62z46e" class="article-share-link">Share</a>
      
        <a href="https://jenujose.github.io/2021/01/13/#Troubleshooting/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Exploring-Microsoft-Tunnel" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/09/Exploring-Microsoft-Tunnel/" class="article-date">
  <time datetime="2020-11-09T12:23:19.000Z" itemprop="datePublished">2020-11-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/09/Exploring-Microsoft-Tunnel/">Exploring Microsoft Tunnel (Part 1)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Microsoft Tunnel is a VPN solution provided by Microsoft that provides connectivity back to the datacenter or on-premises network from mobile devices. All of these features are deployed via Microsoft Intune (MDM). </p>
<p>This feature has always existed with Intune. VPN profiles can be configured in Intune which enables Always-On or per-app VPN connectivity with your firewall of choice. Microsoft Tunnel however makes it easier to configure and deploy a VPN solution as it does not depend on major changes to a companys networking/firewall/vpn solution. Customers moving from away from MobileIron and AirWatch have asked for this type of solution where they can open their mobile app and establish connectivity back home but  it’s always been a challenge to get it working with enterprise network appliances.</p>
<p>The Microsoft solution is implemented on a Linux machine utilizing container technology. Looking under the covers, Microsoft is leveraging OpenVPN technology for the implementation. The approach is a bit confusing since Microsoft also has Always-On-VPN option using Windows Server which it touts as the modern way to use VPN and is compatible with conditional access policies.</p>
<p>As part of this blog post, I’ll explore the installation, configuration and troubleshooting steps. The problem that I’m trying to solve is to have my phone automatically connect to VPN when accessing my video camera application. This way, I don’t have to manually connect to VPN and access my cameras when I am outside of my home network.</p>
<p>To get started, run the install using the MS provided script. The only prequisite that I had to install was the following:<br>Install Docker CE</p>
<p>Since I didn’t want to pay for any certificates, I decided to use my internal Windows Certificate Authority.</p>
<p>On the Intune side, you willl have to create a server, site &amp; server configuration. This will be covered in part two of the post</p>
<h2 id="Create-the-CSR-on-the-Server"><a href="#Create-the-CSR-on-the-Server" class="headerlink" title="Create the CSR on the Server"></a>Create the CSR on the Server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -sha256 -nodes -days 1095 -out \site.csr -newkey rsa:2048 -keyout \site.key -config &lt;(</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;-EOF</span><br><span class="line">[req]</span><br><span class="line">default_bits = 2048</span><br><span class="line">prompt = no</span><br><span class="line">default_md = sha256</span><br><span class="line">req_extensions = req_ext</span><br><span class="line">distinguished_name = dn</span><br><span class="line">[ dn ]</span><br><span class="line">C=US</span><br><span class="line">L=Texas</span><br><span class="line">CN = mstunnel.jenujose.com</span><br><span class="line">[ req_ext ]</span><br><span class="line">subjectAltName = @alt_names</span><br><span class="line">[ alt_names ]</span><br><span class="line">IP.1 = 99.76.16.241</span><br><span class="line">EOF</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="Generate-a-Certificate-from-the-issuing-CA"><a href="#Generate-a-Certificate-from-the-issuing-CA" class="headerlink" title="Generate a Certificate from the issuing CA"></a>Generate a Certificate from the issuing CA</h2><p>This was a tricky one and had to do a bit of googling to remember the commands to issue a certiicate via certutil.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">certutil -submit -attrib &quot;CertificateTemplate:SSLWebServer&quot;</span><br><span class="line"></span><br><span class="line">**Note that the name of the certificate template needs to be typed in without any spaces. Client AUthentication key is what you will need for this to work.</span><br></pre></td></tr></table></figure></p>
<h2 id="Import-the-Cert-into-Linux-box-alongside-bundle-of-certs"><a href="#Import-the-Cert-into-Linux-box-alongside-bundle-of-certs" class="headerlink" title="Import the Cert into Linux box alongside bundle of certs"></a>Import the Cert into Linux box alongside bundle of certs</h2><p>Since I have a two tier certificate authority, I had to bundle up the certificates into a CER file first.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat rootcab.cer intermediatecab.cer &gt; bundle1.cer</span><br><span class="line"></span><br><span class="line">sudo openssl pkcs12 -export -out site.pfx -inkey site.key -in site.cer -certfile bundle1.cer</span><br><span class="line"></span><br><span class="line">-out switch is the certificate bundle supported by MSTunnel.</span><br><span class="line">-inkey switch is the private key that was generated when the  CSR was generatd</span><br><span class="line">-in key.cer - Certificate</span><br><span class="line">-certfile - Root &amp; Intermediate CA</span><br></pre></td></tr></table></figure></p>
<h2 id="Copy-cert-to-MStunnel-directory"><a href="#Copy-cert-to-MStunnel-directory" class="headerlink" title="Copy cert to MStunnel directory"></a>Copy cert to MStunnel directory</h2><p>Before the setup can be run, the PFX file needs to be copied to MStunnel directory<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp site.pfx /etc/mstunnel/private/site.pfx</span><br></pre></td></tr></table></figure></p>
<p>In the next part of the blog post, I will go over the setup on the Intune side to be able to deploy the solution to mobile devices.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jenujose.github.io/2020/11/09/Exploring-Microsoft-Tunnel/" data-id="ckmzmmytq00040oupj1xg7psa" class="article-share-link">Share</a>
      
        <a href="https://jenujose.github.io/2020/11/09/Exploring-Microsoft-Tunnel/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Intune-MEMCM-VPN-Mobility/">Intune, MEMCM, VPN, Mobility</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Reporting-Read-Only-Conditional-Access-Rule" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/20/Reporting-Read-Only-Conditional-Access-Rule/" class="article-date">
  <time datetime="2020-06-20T12:32:22.000Z" itemprop="datePublished">2020-06-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/20/Reporting-Read-Only-Conditional-Access-Rule/">Reporting Report-Only Conditional Access Rule</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>There’s not a  good way to report on results of a report-only conditional access rule.  As of writing this post, you have to look at the result of the rule by digging into each user which can be tedious.</p>
<p>There is a better way to report and it’s through Log Analytics via Kusto Query Language (KQL).</p>
<p>First, you will need to send your Azure AD data to Log Analytics. This requires setting up Azure AD Insights and sendings Azure AD sign in logs to Log Analytics.</p>
<p>After that, run  the following  KQL query to get a list of all singins that would be affected by the report-only conditional access policy. In this instance, we are looking for all sign-ins where the report-only conditional access was succesfullly applied.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SigninLogs</span><br><span class="line">| project ConditionalAccessPolicies, UserDisplayName, AppDisplayName</span><br><span class="line">| where ConditionalAccessPolicies != &quot;[]&quot;</span><br><span class="line">| mv-expand ConditionalAccessPolicies</span><br><span class="line">| extend result = ConditionalAccessPolicies[&quot;result&quot;], CAName = ConditionalAccessPolicies[&quot;displayName&quot;]| project-away ConditionalAccessPolicies</span><br><span class="line">| where result ==  &quot;reportOnlySuccess&quot;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://jenujose.github.io/2020/06/20/Reporting-Read-Only-Conditional-Access-Rule/" data-id="ckmzmmytv00090oupgpozmkff" class="article-share-link">Share</a>
      
        <a href="https://jenujose.github.io/2020/06/20/Reporting-Read-Only-Conditional-Access-Rule/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Gotcha&#39;s with Azure Multi-Factor Authentication" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/14/Gotcha's with Azure Multi-Factor Authentication/" class="article-date">
  <time datetime="2019-04-14T12:21:14.000Z" itemprop="datePublished">2019-04-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/14/Gotcha's with Azure Multi-Factor Authentication/">Azure Multi-Factor Authentication &amp; Conditional Access Policy Tips</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>Do not turn on Multi-Factor Authentication from the legacy MFA console on a per-user basis. Use Conditional access to enforce MFA.<ul>
<li>If you have both options turned on, then legacy MFA wins and will enforce the user for MFA every single time and irrespective of the conditions in your conditional access policies.</li>
<li>Legacy MFA uses App-Passwords which are a terrible user experience for users. This applies to client that don’t support Modern Authentication. They will have to append an app password to their password to login. Instead, consider blocking clients that don’t support MFA.</li>
</ul>
</li>
<li>MFA will only work with conditional access if the client application supports Modern Authentication (ADAL Library).<ul>
<li>That’s right, conditional access policies will not work if the client doesn’t support modern authentication. You can find out what clients are connecting to your organization using Azure AD sign-in logs.</li>
</ul>
</li>
<li>MFA will not be prompted every time use logs in to a service. Azure AD Authentication uses Access Tokens and Refresh tokens to grant access to a service. The access token is valid for an hour at which point the refresh token is used to request another access token (refresh tokens have a longer lifetime than the access tokens). This cycle can continue up to 90 days. Keep in mind conditional access policies are evaluated everytime the service gives you a new access token. These default settings for token lifetimes are <a href="https://techcommunity.microsoft.com/t5/Azure-Active-Directory-Identity/Changes-to-the-Token-Lifetime-Defaults-in-Azure-AD/ba-p/245304" target="_blank" rel="noopener">Microsoft’s</a>  recommendation as they have found no correlation between longer refresh token lifetime and account compromise.</li>
<li>Use Sign-Ins log in Azure Active Directory to troubleshoot issues/understand if/how MFA requirement was met.<ul>
<li>Admins will bring up the fact that MFA is not prompted for users however by looking at the logs you will notice MFA did apply. However, other device claims satisfied the MFA requirement. In other words, it wasn’t a visible “MFA” prompt that the user experienced, however combination of other trust factors such as device compliance, hybrid-Azure AD joined status helped satisfy the MFA requirements.</li>
</ul>
</li>
<li>“Hybrid Azure AD Joined” and “Device is Compliant” should be used with caution. Domain Joined devices need to be synced and registered with Azure AD before it can understand that it’s a domain joined device. There are some <a href="https://docs.microsoft.com/en-us/azure/active-directory/devices/hybrid-azuread-join-plan" target="_blank" rel="noopener">steps</a> that need to be configured before this works. Device is compliant means that it’s an Intune joined device meeting compliance policies.</li>
<li>Block legacy authentication after MFA is deployed so that clients that do not support MFA are not allowed to connect to the organization.</li>
<li>Create <a href="https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/directory-emergency-access" target="_blank" rel="noopener">breakglass</a> accounts just in case you lock yourself out or Microsoft’s MFA service goes down. These accounts should be exempt from MFA and other conditional access policies.</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jenujose.github.io/2019/04/14/Gotcha's with Azure Multi-Factor Authentication/" data-id="ckmzmmytt00070oupelw2o2ed" class="article-share-link">Share</a>
      
        <a href="https://jenujose.github.io/2019/04/14/Gotcha's with Azure Multi-Factor Authentication/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Azure-MFA/">Azure MFA</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Shared-Mailboxes-don-t-automap-to-Outlook-in-Exchange-Online" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/22/Shared-Mailboxes-don-t-automap-to-Outlook-in-Exchange-Online/" class="article-date">
  <time datetime="2017-12-22T14:28:35.000Z" itemprop="datePublished">2017-12-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/22/Shared-Mailboxes-don-t-automap-to-Outlook-in-Exchange-Online/">Shared Mailboxes don&#39;t automap to Outlook in Exchange Online</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>You might see the dreadful error message when trying to open a Shared mailbox mapped to a user.<br><img src="/images/2017/December/Error.png" alt="Error Message"> </p>
<p>Usually it’s a case of incorrect permissions being applied. The weird thing was that the user had no problems accessing the shared mailbox via OWA. </p>
<p>Further looking into the mailbox, I found that MAPI was not enabled. When I tried to enable MAPI from the GUI, it would not make the change.</p>
<p>As a result, I moved onto enabling the change via Powershell which led me to the true error.</p>
<p><img src="/images/2017/December/Powershell_Error.png" alt="Error Message"></p>
<p>So although the user had no license (since it was a shared mailbox) it was showing it had the K1 license…which of course does not allow you access to Outlook. Essentially at one point, the mailbox licensed for K1 and although we removed that license, it never updated the properties on the Exchange side and this is why we couldn’t enable MAPI.</p>
<p>To resolve the issue, I went ahead and temporarily gave it an E3 license and then I had to wait around 30 minutes for that to take effect and then converted it to a shared mailbox.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jenujose.github.io/2017/12/22/Shared-Mailboxes-don-t-automap-to-Outlook-in-Exchange-Online/" data-id="ckmzmmytu00080oup54jsn8xf" class="article-share-link">Share</a>
      
        <a href="https://jenujose.github.io/2017/12/22/Shared-Mailboxes-don-t-automap-to-Outlook-in-Exchange-Online/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Exchange-Online-Office-365/">Exchange Online, Office 365</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-adfs-2016-conditional-access-device-claims" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/13/adfs-2016-conditional-access-device-claims/" class="article-date">
  <time datetime="2016-10-13T06:28:32.000Z" itemprop="datePublished">2016-10-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ADFS/">ADFS</a>►<a class="article-category-link" href="/categories/ADFS/Azure/">Azure</a>►<a class="article-category-link" href="/categories/ADFS/Azure/EMS/">EMS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/13/adfs-2016-conditional-access-device-claims/">ADFS, Device Claims &amp; Conditional Access</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>During a recent EMS POC engagement, my customer asked if there was a way to bypass multi-factor authentication for mobile devices that were registered with Intune/managed by the company. In addition they wanted to be able to get device claims from Windows 10 devices as well so they can determine if the device was being managed by SCCM.</p>
<p>This seems like a pretty reasonable and simple ask until you actually realize the solution entails multiple components to get it properly working.</p>
<p>After some research, I realized I needed ADFS, Azure AD Connect, Azure Device Registration (For Windows devices) and Intune to get this working.</p>
<p>Now for some background..</p>
<ul>
<li>Azure Device Registration – As part of Intune enrollment devices are registered to Azure AD using the ADRS service. This allows a record for the device to be created which contains information about the device. ADRS also supports the registration of domain joined computers as well. We’ll be be using this service to register Windows 10 domain joined computers so that Azure AD knows about them.  </li><li>ADFS – Since ADFS is where the authentication for the user happens, we can get information about the device and the user. What we are interested in are device claims which give us more information about the device that’s being authenticated.  </li><li>Azure AD Connect – Azure AD Connect is a tool used to synchronized your Active Directory to the cloud. It also allows provides a very important feature called Device Write-back. This essentially brings down the objects that are registered to Azure AD to Active Directory so ADFS knows about them. </li>
</ul>
<p><strong><u>Azure Device Registration/Azure AD Connect</u></strong></p>
<p>So how does devices get to Azure AD?</p>
<ul>
<li>Well, mobile devices are easy because part of the Intune enrollment process involved the registration of the device to Azure AD.  </li><li>Now what about Windows devices (7,8,10)? It turns out there’s a mechanism called Azure Device Registration for Windows domain joined devices. For Windows 8.0 and above, this process is built into the operating system and the feature that’s used is “WorkPlace Join”. </li>
</ul>
<p>I won’t go into the details of setting this up but it’s outlined here in the following articles:</p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/active-directory-azureadjoin-devices-group-policy/" title="https://azure.microsoft.com/en-us/documentation/articles/active-directory-azureadjoin-devices-group-policy/" target="_blank" rel="noopener">https://azure.microsoft.com/en-us/documentation/articles/active-directory-azureadjoin-devices-group-policy/</a></p>
<p>Jairo Cadena has the best article that I can find just in case you are interested in how the device registration works:</p>
<p><a href="https://jairocadena.com/2016/01/18/how-domain-join-is-different-in-windows-10-with-azure-ad/" title="https://jairocadena.com/2016/01/18/how-domain-join-is-different-in-windows-10-with-azure-ad/" target="_blank" rel="noopener">https://jairocadena.com/2016/01/18/how-domain-join-is-different-in-windows-10-with-azure-ad/</a></p>
<p>Device registration will work for BOTH customers that are federated (e.g using ADFS) or that’s just doing password synchronization. The caveat is that the computer object needs to be included in the scope of devices that you are syncing using Azure AD Connect or equivalent. <strong>**Update</strong>: Windows 7 Azure AD Registration will ONLY work with ADFS</p>
<p>Azure AD Connect is involved because there’s an option in the tool for device write-back. Since Azure AD registers mobile or Windows devices that are not part of the domain, there needs to be a mechanism that brings down the devices from Azure to Active Directory so that ADFS knows about these devices.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/2016-08-31_07h11_48.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/2016-08-31_07h11_48_thumb.png" alt="2016-08-31_07h11_48" title="2016-08-31_07h11_48"></a></p>
<p>The command above will do the following:</p>
<ol>
<li>Assigns the correct permissions for the Azure AD Connect tool to write back the devices in Azure to AD. In Active Directory, you will notice a “RegisteredDevices” OU in Active Directory. </li>
</ol>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image-7.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb-7.png" alt="image" title="image"></a></p>
<p>In addition, for domain joined Windows 10 computers the following powershell command needs to be run as well after the Azure Active Directory installation is complete.</p>
<p><img src="https://markparris.files.wordpress.com/2015/11/nitialize-adsyncdomainjoinedcomputersync.jpg?w=881&amp;h=618" alt="nitialize-ADSyncDomainJoinedComputerSync"></p>
<p>When you run this script the following happens:</p>
<ol>
<li>Create an SCP (Service Connection Point)&nbsp; record in Active Directory that allows Windows devices to know which Azure AD tenant to connect for the device registration to take place. </li>
</ol>
<p><u><strong>ADFS Configuration</strong></u></p>
<p>On the ADFS front, for device registration to work quickly (instantly) you’ll have to configure ADFS so that necessary claims are passed to Azure AD for authentication. You can find more details by following the article I mentioned in the Azure Device Registration section.</p>
<p>More importantly, you will need to enable device authentication. With ADFS 2012, the setting is configured by checking the box below. Device authentication will help yield the device claims we are looking for.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image-1.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb-1.png" alt="image" title="image"></a></p>
<p>With ADFS 2016, the configuration is moved to a different area and the process in setting this up is much simpler. Device authentication is also associated with device registration. This removes the need to run powershell commands to initialize device registration with ADFS 2012.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image-2.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb-2.png" alt="image" title="image"></a></p>
<p><strong><u>Client Testing</u></strong></p>
<p>So after you get this setup Windows 10 devices that have the anniversary version will automatically register with Azure AD. For older versions of Windows 10, you will need to enable “WorkPlace Join” via group policy.</p>
<p>Windows 8/8.1 also need to have the “WorkPlace Join” GPO enabled.</p>
<p>Windows 7 clients do not have the capability natively however you can install this capability using the following tool:</p>
<p><a href="https://connect.microsoft.com/site1164/program8374" title="https://connect.microsoft.com/site1164/program8374" target="_blank" rel="noopener">https://connect.microsoft.com/site1164/program8374</a></p>
<p>For testing purposes, I setup a sample application that displays all claims. The sample application can be found in the Windows Identity Foundation framework and can be downloaded and setup using this article:</p>
<p><a href="https://blogs.technet.microsoft.com/tangent_thoughts/2015/02/20/install-and-configure-a-simple-net-4-5-sample-federated-application-samapp/" title="https://blogs.technet.microsoft.com/tangent_thoughts/2015/02/20/install-and-configure-a-simple-net-4-5-sample-federated-application-samapp/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/tangent_thoughts/2015/02/20/install-and-configure-a-simple-net-4-5-sample-federated-application-samapp/</a></p>
<p><strong>Caveats: </strong>I spend countless of hours troubleshooting device authentication with Windows 10 and although there’s no article that says this but from testing it does not seem device claims is supported with ADFS 2012. In a ADFS 2016 environment, I was able to get device claims the way I expected.</p>
<p>Here are the results from a Windows 10 (Anniversary Update) machine logging into the sample claims aware applications:</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image-3.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb-3.png" alt="image" title="image"></a></p>
<p>Now we have information about the device itself such as “IsManaged”, “WorkPlace”, we can use these claims to make authentication decisions.</p>
<p>In terms of the device registration of the particular client in Azure AD, you will find the following:</p>
<p>Example of a Windows 10 device that’s domain joined:</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image-4.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb-4.png" alt="image" title="image"></a></p>
<p>Example of Intune joined device:</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image27.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image27_thumb.png" alt="image" title="image"></a></p>
<p>Now that we have all this information, we can use ADFS to ensure that domain joined devices and managed devices bypass multi-factor authentication</p>
<p><strong><u>Making it Work</u></strong></p>
<p>With ADFS 2016, we can do this with Access Control Policies. This is a simplified way of creating issuance rules without the need for the claims language.</p>
<p>For my Office 365 tenant, I’m going to create the following Access Control policy and then apply the policy to my Office 365 relying party trust.</p>
<p>So essentially any user that logs into Office 365 will get a multi-factor authentication prompt except for devices with the claim “Device Trust Level” being “Managed”.&nbsp; In my next post, I’ll deep dive into some of the device claims available and what the different values mean.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image-6.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb-6.png" alt="image" title="image"></a></p>
<p>Now you can take this a step further and use these device claims to enforce conditional access. For example, you can prevent non-managed devices from accessing company resources either in the cloud or on-premise!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jenujose.github.io/2016/10/13/adfs-2016-conditional-access-device-claims/" data-id="ckmzmmyu1000g0oupu30bu2we" class="article-share-link">Share</a>
      
        <a href="https://jenujose.github.io/2016/10/13/adfs-2016-conditional-access-device-claims/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-adfs-2016-mfa" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/08/adfs-2016-mfa/" class="article-date">
  <time datetime="2016-10-08T23:20:30.000Z" itemprop="datePublished">2016-10-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ADFS/">ADFS</a>►<a class="article-category-link" href="/categories/ADFS/Windows-Server/">Windows Server</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/08/adfs-2016-mfa/">ADFS 2016: MFA</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ADFS 2016 changes the way Multi-Factor Authentication (MFA) is&nbsp; configured and used. With previous versions of ADFS, MFA Server was downloaded and the ADFS adapter installed to provide MFA for users and applications. With Windows Server 2016, the architecture has changed so that ADFS 2016 is integrated with Azure MFA. This means that the IT admin does not need to install any special software or adapter to get MFA working. In addition, MFA now can be used as a primary method of authentication—users don’t need to enter in their password to get access to resources, they can verify their identity using their phone (call, text) or by using the Microsoft Authenticator app.</p>
<p>Before ADFS 2016 MFA can be used, MFA servers need to be registered on your Azure AD tenant: This following needs to be done for each ADFS server in the farm. There is good documentation on how to get this done here: <a href="https://technet.microsoft.com/en-us/windows-server-docs/identity/ad-fs/operations/configure-ad-fs-2016-and-azure-mfa" title="https://technet.microsoft.com/en-us/windows-server-docs/identity/ad-fs/operations/configure-ad-fs-2016-and-azure-mfa" target="_blank" rel="noopener">https://technet.microsoft.com/en-us/windows-server-docs/identity/ad-fs/operations/configure-ad-fs-2016-and-azure-mfa</a></p>
<p><strong><span style="text-decoration: underline">Background</span></strong></p>
<p>In my lab environment, I installed ADFS 2016 and used the Export and Import scripts available in the Windows Server 2016 media to move over the settings from my 2012 R2 server. The scripts are located in the Support\ADFS folder of the OS media. The biggest key to making this work is to make sure you use the same service account.</p>
<p>FYI:You can easily add ADFS 2016 server into an existing 2012 farm seamlessly but I did not choose to go that route.</p>
<p><span style="text-decoration: underline"><strong>Configuration</strong></span></p>
<p>A certificate needs to be generated on the ADFS server which will be used for authentication against Azure AD.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb.png" alt="image" title="image"></a></p>
<p>After a certificate is generated, a new service principal needs to created and the certificate information associated with the service principal. This allows the ADFS servers to authenticate/communicate with the Azure MFA client successfully.</p>
<p>When executing the command to create the service principal ID, you are met with an error saying the end date is an invalid parameter. This seems to be a bug and I was able to get around this by omitting the start and end date altogether.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image1.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb1.png" alt="image" title="image"></a></p>
<p>Now that I have MFA service registered with Azure AD, I can go ahead and enable MFA as an authentication method.&nbsp; MFA can be used&nbsp; the primary method of authentication or secondary. Using MFA as a primary method of authentication is great news—this means you don’t have to use your password when logging on to company resources</p>
<p>For my test environment, I’ve setup ADFS with the following configuration:</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/2016-10-08_13h06_13.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/2016-10-08_13h06_13_thumb.png" alt="2016-10-08_13h06_13" title="2016-10-08_13h06_13"></a></p>
<p>One of the prerequisites to get Azure MFA to work on-premise is that the “proof-up” or the setup of MFA information needs to happen in Azure AD. This means that multi-factor authentication needs to be enabled for the user. I’ve raised this issue with MS because essentially to use ADFS based Azure MFA you need to turn on Azure AD MFA (more on this later)</p>
<p>Since we’ve enabled both ADFS based Azure MFA and Azure AD MFA, we need a way to prevent double&nbsp; double MFA prompts (one from Azure and one from ADFS). You will need to change your domain federation settings to the following:</p>
<p>Set-MsolDomainFederationSettings –DomainName domainname.com -SupportsMFA $false</p>
<p>In addition, you will need to pass the MFA claim from ADFS to Azure AD so it will understand that you have already successfully authenticated via MFA on-premises. This should be added to the Office 365 Relying Party Trust (which is service I’m testing against)</p>
<p>(=&gt; issue(Type = “<a href="http://schemas.microsoft.com/claims/authnmethodsreferences" target="_blank" rel="noopener">http://schemas.microsoft.com/claims/authnmethodsreferences</a>“, Value = “<a href="http://schemas.microsoft.com/claims/multipleauthn" target="_blank" rel="noopener">http://schemas.microsoft.com/claims/multipleauthn</a>“);) </p>
<p>**After raising the proof-up question with MS they recommended to use the following for these scenarios:</p>
<p>1) Authenticating to Internal Applications – Internal applications will be able to leverage ADFS based Azure MFA for authentication. This assumes that the user has setup alternate authentication methods in Azure AD. You can send the user the link to set up MFA methods or if they use Office 365 or Microsoft cloud services, they will be forced to go through this setup.</p>
<p>2) Authenticating to Azure AD Applications – For Azure AD applications, Azure AD MFA will provide authentication. This is of course assuming Azure MFA is turned on for the user.</p>
<p>From testing, I was able to use ADFS based MFA for both scenarios and get it to work.&nbsp; It worked because I went through the initial proof-up setup (Turning on MFA in Azure AD or Setting up alternate authentication methods by going to myapps.microsoft.com)</p>
<p><span style="text-decoration: underline"><strong>User Experience</strong></span></p>
<p>When a user logs in for the first time to Office 365, they will be met with a prompt to setup MFA (I’ve set the SupportsMFA parameter to false and enabled MFA for the user in Azure AD)</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image41.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image4_thumb.png" alt="image" title="image"></a>.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image71.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image7_thumb.png" alt="image" title="image"></a></p>
<p>I configured MFA for&nbsp; my test account to use mobile app notifications. Once you click on “Set up” you will receive a QR code which you can scan using the Microsoft Authenticator app (Work Account). Now when I login to Office 365, I’m redirected to my ADFS server and you will notice an option at the bottom for MFA Authentication:</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image13.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image13_thumb.png" alt="image" title="image"></a></p>
<p>Once you click on Azure Multi-Factor Authentication, you will have to then use the verification code from the Microsoft Authenticator app to authenticate yourself to Office 365.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image16.png" target="_blank" rel="noopener"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image16_thumb.png" alt="image" title="image"></a></p>
<p><span style="text-decoration: underline"><strong>Recommendations/Thoughts</strong>:</span></p>
<ol>
<li>MFA as a primary method of authentication helps prevent the use of passwords thereby reducing the chance that the password gets stolen &amp; it improves the experience of users that are trying to login with mobile devices where there’s not much real estate on the keyboard to type in a complex password.  </li><li>I suspect more documentation on this topic will be published before Windows Server 2016 is available to corporate customers which might explain some of the caveats I’ve run into.  </li><li>The integration of the cloud services such as the MFA service with the Server OS is a great way to unify the setup and configuration process regardless of if you are hybrid or cloud organization.</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jenujose.github.io/2016/10/08/adfs-2016-mfa/" data-id="ckmzmmyu3000j0oupktafnqf8" class="article-share-link">Share</a>
      
        <a href="https://jenujose.github.io/2016/10/08/adfs-2016-mfa/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-microsoft-intune-per-app-vpn-for-android" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/30/microsoft-intune-per-app-vpn-for-android/" class="article-date">
  <time datetime="2016-09-30T16:58:14.000Z" itemprop="datePublished">2016-09-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Uncategorized/">Uncategorized</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/30/microsoft-intune-per-app-vpn-for-android/">Microsoft Intune Per-App VPN for Android</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Microsoft Intune currently offers support for per-app VPN on Android if used with Pulse Secure. This <a href="https://docs.microsoft.com/en-us/intune/deploy-use/per-app-vpn-for-android-pulse-secure" target="_blank" rel="noopener">functionality</a> has been available for a while on iOS devices where the VPN tunnel is initiated when a user launches an application or hits a URL that’s been defined by the IT Administrator. This is a great way to ensure that mobile applications tunnel back internally to get data.</p>
<p>Recently, while testing out per-app VPN on Android with the Pulse Secure client it appears as though this functionality although published here was not working.</p>
<p>It took a while to realize that the per-app VPN works very differently with Android devices. Here’s the response received from the developer that implemented the feature:</p>
<p><em>In Android, PerAppVpn works a little different than iOS. It does not launch the VPN automatically when the app is opened, so the customer has to go open the PulseSecure VPN client manually and start the connection first. PulseSecure will then only allow traffic from the specified app(s) in the VPN profile to go through the VPN tunnel.</em></p>
<p>I’m hoping that this functionality becomes more like the experience on iOS devices because the whole goal is for the device to auto-initiate the VPN without users having to do this. Hopefully this is something that Android for Work can help solve as MDM capabilities are standardized across Android phones.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jenujose.github.io/2016/09/30/microsoft-intune-per-app-vpn-for-android/" data-id="ckmzmmyu9000q0oupphmdahwj" class="article-share-link">Share</a>
      
        <a href="https://jenujose.github.io/2016/09/30/microsoft-intune-per-app-vpn-for-android/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ADFS/">ADFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ADFS/Azure/">Azure</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ADFS/Azure/EMS/">EMS</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/ADFS/Windows-Server/">Windows Server</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Azure/">Azure</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Azure/EMS/">EMS</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/SCCM/">SCCM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Uncategorized/">Uncategorized</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure-MFA/">Azure MFA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Exchange-Online-Office-365/">Exchange Online, Office 365</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Intune-MEMCM-VPN-Mobility/">Intune, MEMCM, VPN, Mobility</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SCCM/">SCCM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/">SQL</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Azure-MFA/" style="font-size: 10px;">Azure MFA</a> <a href="/tags/Exchange-Online-Office-365/" style="font-size: 10px;">Exchange Online, Office 365</a> <a href="/tags/Intune-MEMCM-VPN-Mobility/" style="font-size: 10px;">Intune, MEMCM, VPN, Mobility</a> <a href="/tags/SCCM/" style="font-size: 10px;">SCCM</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/11/Exploring-Microsoft-Tunnel-Part-3/">Exploring Microsoft Tunnel (Part 3)</a>
          </li>
        
          <li>
            <a href="/2021/01/18/Exploring-Microsoft-Tunnel-Part-2/">Exploring Microsoft Tunnel (Part 2)</a>
          </li>
        
          <li>
            <a href="/2021/01/13/#Troubleshooting/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/11/09/Exploring-Microsoft-Tunnel/">Exploring Microsoft Tunnel (Part 1)</a>
          </li>
        
          <li>
            <a href="/2020/06/20/Reporting-Read-Only-Conditional-Access-Rule/">Reporting Report-Only Conditional Access Rule</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Jenu Jose<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'blog-jenujose-com';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>