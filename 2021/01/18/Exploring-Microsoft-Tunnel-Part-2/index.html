<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-138306519-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>Exploring Microsoft Tunnel (Part 2) | Cloud &amp; Security Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="In Part 1, we looked at some of the pre-requisites and installation of the Microsoft Tunnel. In this post, we will look at the Intune side. In part 3, we will go over the solution in action as well as">
<meta property="og:type" content="article">
<meta property="og:title" content="Exploring Microsoft Tunnel (Part 2)">
<meta property="og:url" content="https://jenujose.github.io/2021/01/18/Exploring-Microsoft-Tunnel-Part-2/index.html">
<meta property="og:site_name" content="Cloud &amp; Security Blog">
<meta property="og:description" content="In Part 1, we looked at some of the pre-requisites and installation of the Microsoft Tunnel. In this post, we will look at the Intune side. In part 3, we will go over the solution in action as well as">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://jenujose.github.io/2021/01/18/images/2021/January/2020-11-30_20h40_00.png">
<meta property="og:image" content="https://jenujose.github.io/2021/01/18/images/2021/January/2020-11-30_20h40_48.png">
<meta property="og:image" content="https://jenujose.github.io/2021/01/18/images/2021/January/2021-01-18_14h03_01.png">
<meta property="og:image" content="https://jenujose.github.io/2021/01/18/images/2021/January/2021-01-18_14h07_29.png">
<meta property="og:updated_time" content="2021-01-21T03:40:58.022Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Exploring Microsoft Tunnel (Part 2)">
<meta name="twitter:description" content="In Part 1, we looked at some of the pre-requisites and installation of the Microsoft Tunnel. In this post, we will look at the Intune side. In part 3, we will go over the solution in action as well as">
<meta name="twitter:image" content="https://jenujose.github.io/2021/01/18/images/2021/January/2020-11-30_20h40_00.png">
<meta name="twitter:creator" content="@jenu">
  
    <link rel="alternate" href="/atom.xml" title="Cloud &amp; Security Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Cloud &amp; Security Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://jenujose.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Exploring-Microsoft-Tunnel-Part-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/01/18/Exploring-Microsoft-Tunnel-Part-2/" class="article-date">
  <time datetime="2021-01-18T14:45:49.000Z" itemprop="datePublished">2021-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Exploring Microsoft Tunnel (Part 2)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In Part 1, we looked at some of the pre-requisites and installation of the Microsoft Tunnel. In this post, we will look at the Intune side. In part 3, we will go over the solution in action as well as ways to troubleshoot any issues.</p>
<h2 id="Intune-Server-and-Site-Configuration"><a href="#Intune-Server-and-Site-Configuration" class="headerlink" title="Intune Server and Site Configuration"></a>Intune Server and Site Configuration</h2><p>On the Intune side, you have to create a Server Configuration and Site Configuration. </p>
<p><code>Server Configuration - Defines DNS servers, split tunneling and server port information.</code></p>
<ul>
<li>IP Address Range - Defines the ip addresses reserved for clients when connecting to MS Tunnel VPN</li>
<li>DNS Servers - Defines DNS servers to be used when connected to MS Tunnel VPN</li>
<li>Split Tunneling - Defines subnets where the client will route traffic through MS Tunnel VPN</li>
<li>Server Port - Defines port to connect to the server</li>
</ul>
<p><img src="./images/2021/../../../images/2021/January/2020-11-30_20h40_00.png" alt="Server Configuration"></p>
<ul>
<li>Public IP address or FQDN - Defines the public ip address or DNS name of the server.</li>
<li>Server Configuration - Select a previously defined server configuration.</li>
</ul>
<p><code>Site Configuration - Defines the public IP address as well as server configuration.</code></p>
<p><img src="./images/2021/../../../images/2021/January/2020-11-30_20h40_48.png" alt="Site Configuration"></p>
<p><code>Server Configuration  - Is where you go to download the installer script. Once the script is run, this section will highlight the servers that are configured.</code> </p>
<p>The file is a bash script that runs a function to configure the server.</p>
<h2 id="Run-the-tunnel-setup"><a href="#Run-the-tunnel-setup" class="headerlink" title="Run the tunnel setup"></a>Run the tunnel setup</h2><p>Before the setup can be run, the PFX file needs to be copied to MStunnel directory<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://aka.ms/microsofttunneldownload -O mstunnel-setup</span><br><span class="line">sudo ./mstunnel-setup</span><br></pre></td></tr></table></figure></p>
<h2 id="Intune-Client-Configuration"><a href="#Intune-Client-Configuration" class="headerlink" title="Intune Client Configuration"></a>Intune Client Configuration</h2><p>Also on the Intune side, two configuration profiles were created to deploy the root and trusted CA certs to the mobile device.</p>
<p>A VPN profile was deployed as well with the Microsoft tunnel. The connection type was set to Microsoft Tunnel.<br><img src="./images/2021/../../../images/2021/January/2021-01-18_14h03_01.png" alt="VPN Configuration"></p>
<p>Lastly, the per-app VPN needs to be associated at the app deployment level. In my case, the app I wanted the on-demand VPN for was configured to use my MSTunnel configuration policy.</p>
<p><img src="./images/2021/../../../images/2021/January/2021-01-18_14h07_29.png" alt="App Configuration"></p>
<p>The Microsoft Tunnel App also needs to be deployed to the clients as well. This app is used to connect to the VPN and also to enforce conditional acccess rules (2FA for example). In the next and last part of this blog, we will go over the solution end to end.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jenujose.github.io/2021/01/18/Exploring-Microsoft-Tunnel-Part-2/" data-id="ckmzmk2ci00049sup8z8ugv18" class="article-share-link">Share</a>
      
        <a href="https://jenujose.github.io/2021/01/18/Exploring-Microsoft-Tunnel-Part-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/03/11/Exploring-Microsoft-Tunnel-Part-3/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Exploring Microsoft Tunnel (Part 3)
        
      </div>
    </a>
  
  
    <a href="/2021/01/13/#Troubleshooting/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ADFS/">ADFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ADFS/Azure/">Azure</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ADFS/Azure/EMS/">EMS</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/ADFS/Windows-Server/">Windows Server</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Azure/">Azure</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Azure/EMS/">EMS</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/SCCM/">SCCM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Uncategorized/">Uncategorized</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure-MFA/">Azure MFA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Exchange-Online-Office-365/">Exchange Online, Office 365</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Intune-MEMCM-VPN-Mobility/">Intune, MEMCM, VPN, Mobility</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SCCM/">SCCM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/">SQL</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Azure-MFA/" style="font-size: 10px;">Azure MFA</a> <a href="/tags/Exchange-Online-Office-365/" style="font-size: 10px;">Exchange Online, Office 365</a> <a href="/tags/Intune-MEMCM-VPN-Mobility/" style="font-size: 10px;">Intune, MEMCM, VPN, Mobility</a> <a href="/tags/SCCM/" style="font-size: 10px;">SCCM</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/11/Exploring-Microsoft-Tunnel-Part-3/">Exploring Microsoft Tunnel (Part 3)</a>
          </li>
        
          <li>
            <a href="/2021/01/18/Exploring-Microsoft-Tunnel-Part-2/">Exploring Microsoft Tunnel (Part 2)</a>
          </li>
        
          <li>
            <a href="/2021/01/13/#Troubleshooting/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/11/09/Exploring-Microsoft-Tunnel/">Exploring Microsoft Tunnel (Part 1)</a>
          </li>
        
          <li>
            <a href="/2020/06/20/Reporting-Read-Only-Conditional-Access-Rule/">Reporting Report-Only Conditional Access Rule</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Jenu Jose<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'blog-jenujose-com';
  
  var disqus_url = 'https://jenujose.github.io/2021/01/18/Exploring-Microsoft-Tunnel-Part-2/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>