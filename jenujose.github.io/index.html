<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en-us">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Notes from the field...">
<meta property="og:url" content="https://jenujose.github.io/index.html">
<meta property="og:site_name" content="Notes from the field...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Notes from the field...">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://jenujose.github.io/"/>





  <title>Notes from the field...</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en-us">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Notes from the field...</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jenujose.github.io/2017/12/22/Shared-Mailboxes-don-t-automap-to-Outlook-in-Exchange-Online/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jenu Jose">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes from the field...">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/22/Shared-Mailboxes-don-t-automap-to-Outlook-in-Exchange-Online/" itemprop="url">Shared Mailboxes don't automap to Outlook in Exchange Online</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-22T08:28:35-06:00">
                2017-12-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/22/Shared-Mailboxes-don-t-automap-to-Outlook-in-Exchange-Online/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/22/Shared-Mailboxes-don-t-automap-to-Outlook-in-Exchange-Online/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>You might see the dreadful error message when trying to open a Shared mailbox mapped to a user.<br><img src="/images/2017/December/Error.png" alt="Error Message"> </p>
<p>Usually it’s a case of incorrect permissions being applied. The weird thing was that the user had no problems accessing the shared mailbox via OWA. </p>
<p>Further looking into the mailbox, I found that MAPI was not enabled. When I tried to enable MAPI from the GUI, it would not make the change.</p>
<p>As a result, I moved onto enabling the change via Powershell which led me to the true error.</p>
<p><img src="/images/2017/December/Powershell_Error.png" alt="Error Message"></p>
<p>So although the user had no license (since it was a shared mailbox) it was showing it had the K1 license…which of course does not allow you access to Outlook. Essentially at one point, the mailbox licensed for K1 and although we removed that license, it never updated the properties on the Exchange side and this is why we couldn’t enable MAPI.</p>
<p>To resolve the issue, I went ahead and temporarily gave it an E3 license and then I had to wait around 30 minutes for that to take effect and then converted it to a shared mailbox.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jenujose.github.io/2016/10/13/adfs-2016-conditional-access-device-claims/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jenu Jose">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes from the field...">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/13/adfs-2016-conditional-access-device-claims/" itemprop="url">ADFS, Device Claims & Conditional Access</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-13T01:28:32-05:00">
                2016-10-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ADFS/" itemprop="url" rel="index">
                    <span itemprop="name">ADFS</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ADFS/Azure/" itemprop="url" rel="index">
                    <span itemprop="name">Azure</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ADFS/Azure/EMS/" itemprop="url" rel="index">
                    <span itemprop="name">EMS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/10/13/adfs-2016-conditional-access-device-claims/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/10/13/adfs-2016-conditional-access-device-claims/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>During a recent EMS POC engagement, my customer asked if there was a way to bypass multi-factor authentication for mobile devices that were registered with Intune/managed by the company. In addition they wanted to be able to get device claims from Windows 10 devices as well so they can determine if the device was being managed by SCCM.</p>
<p>This seems like a pretty reasonable and simple ask until you actually realize the solution entails multiple components to get it properly working.</p>
<p>After some research, I realized I needed ADFS, Azure AD Connect, Azure Device Registration (For Windows devices) and Intune to get this working.</p>
<p>Now for some background..</p>
<ul>
<li>Azure Device Registration – As part of Intune enrollment devices are registered to Azure AD using the ADRS service. This allows a record for the device to be created which contains information about the device. ADRS also supports the registration of domain joined computers as well. We’ll be be using this service to register Windows 10 domain joined computers so that Azure AD knows about them.  </li><li>ADFS – Since ADFS is where the authentication for the user happens, we can get information about the device and the user. What we are interested in are device claims which give us more information about the device that’s being authenticated.  </li><li>Azure AD Connect – Azure AD Connect is a tool used to synchronized your Active Directory to the cloud. It also allows provides a very important feature called Device Write-back. This essentially brings down the objects that are registered to Azure AD to Active Directory so ADFS knows about them. </li>
</ul>
<p><strong><u>Azure Device Registration/Azure AD Connect</u></strong></p>
<p>So how does devices get to Azure AD?</p>
<ul>
<li>Well, mobile devices are easy because part of the Intune enrollment process involved the registration of the device to Azure AD.  </li><li>Now what about Windows devices (7,8,10)? It turns out there’s a mechanism called Azure Device Registration for Windows domain joined devices. For Windows 8.0 and above, this process is built into the operating system and the feature that’s used is “WorkPlace Join”. </li>
</ul>
<p>I won’t go into the details of setting this up but it’s outlined here in the following articles:</p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/active-directory-azureadjoin-devices-group-policy/" title="https://azure.microsoft.com/en-us/documentation/articles/active-directory-azureadjoin-devices-group-policy/" target="_blank" rel="external">https://azure.microsoft.com/en-us/documentation/articles/active-directory-azureadjoin-devices-group-policy/</a></p>
<p>Jairo Cadena has the best article that I can find just in case you are interested in how the device registration works:</p>
<p><a href="https://jairocadena.com/2016/01/18/how-domain-join-is-different-in-windows-10-with-azure-ad/" title="https://jairocadena.com/2016/01/18/how-domain-join-is-different-in-windows-10-with-azure-ad/" target="_blank" rel="external">https://jairocadena.com/2016/01/18/how-domain-join-is-different-in-windows-10-with-azure-ad/</a></p>
<p>Device registration will work for BOTH customers that are federated (e.g using ADFS) or that’s just doing password synchronization. The caveat is that the computer object needs to be included in the scope of devices that you are syncing using Azure AD Connect or equivalent. <strong>**Update</strong>: Windows 7 Azure AD Registration will ONLY work with ADFS</p>
<p>Azure AD Connect is involved because there’s an option in the tool for device write-back. Since Azure AD registers mobile or Windows devices that are not part of the domain, there needs to be a mechanism that brings down the devices from Azure to Active Directory so that ADFS knows about these devices.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/2016-08-31_07h11_48.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/2016-08-31_07h11_48_thumb.png" alt="2016-08-31_07h11_48" title="2016-08-31_07h11_48"></a></p>
<p>The command above will do the following:</p>
<ol>
<li>Assigns the correct permissions for the Azure AD Connect tool to write back the devices in Azure to AD. In Active Directory, you will notice a “RegisteredDevices” OU in Active Directory. </li>
</ol>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image-7.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb-7.png" alt="image" title="image"></a></p>
<p>In addition, for domain joined Windows 10 computers the following powershell command needs to be run as well after the Azure Active Directory installation is complete.</p>
<p><img src="https://markparris.files.wordpress.com/2015/11/nitialize-adsyncdomainjoinedcomputersync.jpg?w=881&amp;h=618" alt="nitialize-ADSyncDomainJoinedComputerSync"></p>
<p>When you run this script the following happens:</p>
<ol>
<li>Create an SCP (Service Connection Point)&nbsp; record in Active Directory that allows Windows devices to know which Azure AD tenant to connect for the device registration to take place. </li>
</ol>
<p><u><strong>ADFS Configuration</strong></u></p>
<p>On the ADFS front, for device registration to work quickly (instantly) you’ll have to configure ADFS so that necessary claims are passed to Azure AD for authentication. You can find more details by following the article I mentioned in the Azure Device Registration section.</p>
<p>More importantly, you will need to enable device authentication. With ADFS 2012, the setting is configured by checking the box below. Device authentication will help yield the device claims we are looking for.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image-1.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb-1.png" alt="image" title="image"></a></p>
<p>With ADFS 2016, the configuration is moved to a different area and the process in setting this up is much simpler. Device authentication is also associated with device registration. This removes the need to run powershell commands to initialize device registration with ADFS 2012.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image-2.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb-2.png" alt="image" title="image"></a></p>
<p><strong><u>Client Testing</u></strong></p>
<p>So after you get this setup Windows 10 devices that have the anniversary version will automatically register with Azure AD. For older versions of Windows 10, you will need to enable “WorkPlace Join” via group policy.</p>
<p>Windows 8/8.1 also need to have the “WorkPlace Join” GPO enabled.</p>
<p>Windows 7 clients do not have the capability natively however you can install this capability using the following tool:</p>
<p><a href="https://connect.microsoft.com/site1164/program8374" title="https://connect.microsoft.com/site1164/program8374" target="_blank" rel="external">https://connect.microsoft.com/site1164/program8374</a></p>
<p>For testing purposes, I setup a sample application that displays all claims. The sample application can be found in the Windows Identity Foundation framework and can be downloaded and setup using this article:</p>
<p><a href="https://blogs.technet.microsoft.com/tangent_thoughts/2015/02/20/install-and-configure-a-simple-net-4-5-sample-federated-application-samapp/" title="https://blogs.technet.microsoft.com/tangent_thoughts/2015/02/20/install-and-configure-a-simple-net-4-5-sample-federated-application-samapp/" target="_blank" rel="external">https://blogs.technet.microsoft.com/tangent_thoughts/2015/02/20/install-and-configure-a-simple-net-4-5-sample-federated-application-samapp/</a></p>
<p><strong>Caveats: </strong>I spend countless of hours troubleshooting device authentication with Windows 10 and although there’s no article that says this but from testing it does not seem device claims is supported with ADFS 2012. In a ADFS 2016 environment, I was able to get device claims the way I expected.</p>
<p>Here are the results from a Windows 10 (Anniversary Update) machine logging into the sample claims aware applications:</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image-3.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb-3.png" alt="image" title="image"></a></p>
<p>Now we have information about the device itself such as “IsManaged”, “WorkPlace”, we can use these claims to make authentication decisions.</p>
<p>In terms of the device registration of the particular client in Azure AD, you will find the following:</p>
<p>Example of a Windows 10 device that’s domain joined:</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image-4.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb-4.png" alt="image" title="image"></a></p>
<p>Example of Intune joined device:</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image27.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image27_thumb.png" alt="image" title="image"></a></p>
<p>Now that we have all this information, we can use ADFS to ensure that domain joined devices and managed devices bypass multi-factor authentication</p>
<p><strong><u>Making it Work</u></strong></p>
<p>With ADFS 2016, we can do this with Access Control Policies. This is a simplified way of creating issuance rules without the need for the claims language.</p>
<p>For my Office 365 tenant, I’m going to create the following Access Control policy and then apply the policy to my Office 365 relying party trust.</p>
<p>So essentially any user that logs into Office 365 will get a multi-factor authentication prompt except for devices with the claim “Device Trust Level” being “Managed”.&nbsp; In my next post, I’ll deep dive into some of the device claims available and what the different values mean.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image-6.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb-6.png" alt="image" title="image"></a></p>
<p>Now you can take this a step further and use these device claims to enforce conditional access. For example, you can prevent non-managed devices from accessing company resources either in the cloud or on-premise!</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jenujose.github.io/2016/10/08/adfs-2016-mfa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jenu Jose">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes from the field...">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/08/adfs-2016-mfa/" itemprop="url">ADFS 2016: MFA</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-08T18:20:30-05:00">
                2016-10-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ADFS/" itemprop="url" rel="index">
                    <span itemprop="name">ADFS</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ADFS/Windows-Server/" itemprop="url" rel="index">
                    <span itemprop="name">Windows Server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/10/08/adfs-2016-mfa/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/10/08/adfs-2016-mfa/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ADFS 2016 changes the way Multi-Factor Authentication (MFA) is&nbsp; configured and used. With previous versions of ADFS, MFA Server was downloaded and the ADFS adapter installed to provide MFA for users and applications. With Windows Server 2016, the architecture has changed so that ADFS 2016 is integrated with Azure MFA. This means that the IT admin does not need to install any special software or adapter to get MFA working. In addition, MFA now can be used as a primary method of authentication—users don’t need to enter in their password to get access to resources, they can verify their identity using their phone (call, text) or by using the Microsoft Authenticator app.</p>
<p>Before ADFS 2016 MFA can be used, MFA servers need to be registered on your Azure AD tenant: This following needs to be done for each ADFS server in the farm. There is good documentation on how to get this done here: <a href="https://technet.microsoft.com/en-us/windows-server-docs/identity/ad-fs/operations/configure-ad-fs-2016-and-azure-mfa" title="https://technet.microsoft.com/en-us/windows-server-docs/identity/ad-fs/operations/configure-ad-fs-2016-and-azure-mfa" target="_blank" rel="external">https://technet.microsoft.com/en-us/windows-server-docs/identity/ad-fs/operations/configure-ad-fs-2016-and-azure-mfa</a></p>
<p><strong><span style="text-decoration: underline">Background</span></strong></p>
<p>In my lab environment, I installed ADFS 2016 and used the Export and Import scripts available in the Windows Server 2016 media to move over the settings from my 2012 R2 server. The scripts are located in the Support\ADFS folder of the OS media. The biggest key to making this work is to make sure you use the same service account.</p>
<p>FYI:You can easily add ADFS 2016 server into an existing 2012 farm seamlessly but I did not choose to go that route.</p>
<p><span style="text-decoration: underline"><strong>Configuration</strong></span></p>
<p>A certificate needs to be generated on the ADFS server which will be used for authentication against Azure AD.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb.png" alt="image" title="image"></a></p>
<p>After a certificate is generated, a new service principal needs to created and the certificate information associated with the service principal. This allows the ADFS servers to authenticate/communicate with the Azure MFA client successfully.</p>
<p>When executing the command to create the service principal ID, you are met with an error saying the end date is an invalid parameter. This seems to be a bug and I was able to get around this by omitting the start and end date altogether.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image1.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image_thumb1.png" alt="image" title="image"></a></p>
<p>Now that I have MFA service registered with Azure AD, I can go ahead and enable MFA as an authentication method.&nbsp; MFA can be used&nbsp; the primary method of authentication or secondary. Using MFA as a primary method of authentication is great news—this means you don’t have to use your password when logging on to company resources</p>
<p>For my test environment, I’ve setup ADFS with the following configuration:</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/2016-10-08_13h06_13.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/2016-10-08_13h06_13_thumb.png" alt="2016-10-08_13h06_13" title="2016-10-08_13h06_13"></a></p>
<p>One of the prerequisites to get Azure MFA to work on-premise is that the “proof-up” or the setup of MFA information needs to happen in Azure AD. This means that multi-factor authentication needs to be enabled for the user. I’ve raised this issue with MS because essentially to use ADFS based Azure MFA you need to turn on Azure AD MFA (more on this later)</p>
<p>Since we’ve enabled both ADFS based Azure MFA and Azure AD MFA, we need a way to prevent double&nbsp; double MFA prompts (one from Azure and one from ADFS). You will need to change your domain federation settings to the following:</p>
<p>Set-MsolDomainFederationSettings –DomainName domainname.com -SupportsMFA $false</p>
<p>In addition, you will need to pass the MFA claim from ADFS to Azure AD so it will understand that you have already successfully authenticated via MFA on-premises. This should be added to the Office 365 Relying Party Trust (which is service I’m testing against)</p>
<p>(=&gt; issue(Type = “<a href="http://schemas.microsoft.com/claims/authnmethodsreferences" target="_blank" rel="external">http://schemas.microsoft.com/claims/authnmethodsreferences</a>“, Value = “<a href="http://schemas.microsoft.com/claims/multipleauthn" target="_blank" rel="external">http://schemas.microsoft.com/claims/multipleauthn</a>“);) </p>
<p>**After raising the proof-up question with MS they recommended to use the following for these scenarios:</p>
<p>1) Authenticating to Internal Applications – Internal applications will be able to leverage ADFS based Azure MFA for authentication. This assumes that the user has setup alternate authentication methods in Azure AD. You can send the user the link to set up MFA methods or if they use Office 365 or Microsoft cloud services, they will be forced to go through this setup.</p>
<p>2) Authenticating to Azure AD Applications – For Azure AD applications, Azure AD MFA will provide authentication. This is of course assuming Azure MFA is turned on for the user.</p>
<p>From testing, I was able to use ADFS based MFA for both scenarios and get it to work.&nbsp; It worked because I went through the initial proof-up setup (Turning on MFA in Azure AD or Setting up alternate authentication methods by going to myapps.microsoft.com)</p>
<p><span style="text-decoration: underline"><strong>User Experience</strong></span></p>
<p>When a user logs in for the first time to Office 365, they will be met with a prompt to setup MFA (I’ve set the SupportsMFA parameter to false and enabled MFA for the user in Azure AD)</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image41.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image4_thumb.png" alt="image" title="image"></a>.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image71.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image7_thumb.png" alt="image" title="image"></a></p>
<p>I configured MFA for&nbsp; my test account to use mobile app notifications. Once you click on “Set up” you will receive a QR code which you can scan using the Microsoft Authenticator app (Work Account). Now when I login to Office 365, I’m redirected to my ADFS server and you will notice an option at the bottom for MFA Authentication:</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image13.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image13_thumb.png" alt="image" title="image"></a></p>
<p>Once you click on Azure Multi-Factor Authentication, you will have to then use the verification code from the Microsoft Authenticator app to authenticate yourself to Office 365.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2016/10/image16.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2016/10/image16_thumb.png" alt="image" title="image"></a></p>
<p><span style="text-decoration: underline"><strong>Recommendations/Thoughts</strong>:</span></p>
<ol>
<li>MFA as a primary method of authentication helps prevent the use of passwords thereby reducing the chance that the password gets stolen &amp; it improves the experience of users that are trying to login with mobile devices where there’s not much real estate on the keyboard to type in a complex password.  </li><li>I suspect more documentation on this topic will be published before Windows Server 2016 is available to corporate customers which might explain some of the caveats I’ve run into.  </li><li>The integration of the cloud services such as the MFA service with the Server OS is a great way to unify the setup and configuration process regardless of if you are hybrid or cloud organization.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jenujose.github.io/2016/09/30/microsoft-intune-per-app-vpn-for-android/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jenu Jose">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes from the field...">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/30/microsoft-intune-per-app-vpn-for-android/" itemprop="url">Microsoft Intune Per-App VPN for Android</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-30T11:58:14-05:00">
                2016-09-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Uncategorized/" itemprop="url" rel="index">
                    <span itemprop="name">Uncategorized</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/09/30/microsoft-intune-per-app-vpn-for-android/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/09/30/microsoft-intune-per-app-vpn-for-android/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Microsoft Intune currently offers support for per-app VPN on Android if used with Pulse Secure. This <a href="https://docs.microsoft.com/en-us/intune/deploy-use/per-app-vpn-for-android-pulse-secure" target="_blank" rel="external">functionality</a> has been available for a while on iOS devices where the VPN tunnel is initiated when a user launches an application or hits a URL that’s been defined by the IT Administrator. This is a great way to ensure that mobile applications tunnel back internally to get data.</p>
<p>Recently, while testing out per-app VPN on Android with the Pulse Secure client it appears as though this functionality although published here was not working.</p>
<p>It took a while to realize that the per-app VPN works very differently with Android devices. Here’s the response received from the developer that implemented the feature:</p>
<p><em>In Android, PerAppVpn works a little different than iOS. It does not launch the VPN automatically when the app is opened, so the customer has to go open the PulseSecure VPN client manually and start the connection first. PulseSecure will then only allow traffic from the specified app(s) in the VPN profile to go through the VPN tunnel.</em></p>
<p>I’m hoping that this functionality becomes more like the experience on iOS devices because the whole goal is for the device to auto-initiate the VPN without users having to do this. Hopefully this is something that Android for Work can help solve as MDM capabilities are standardized across Android phones.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jenujose.github.io/2015/12/01/publishing-owa-with-azure-application-proxy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jenu Jose">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes from the field...">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/12/01/publishing-owa-with-azure-application-proxy/" itemprop="url">Publishing OWA with Azure Application Proxy</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-12-01T01:28:48-06:00">
                2015-12-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Azure/" itemprop="url" rel="index">
                    <span itemprop="name">Azure</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Azure/EMS/" itemprop="url" rel="index">
                    <span itemprop="name">EMS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/12/01/publishing-owa-with-azure-application-proxy/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/12/01/publishing-owa-with-azure-application-proxy/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Azure Application proxy is an exciting technology that’s available with Azure AD Premium. It allows you to publish internal web applications in a simple and secure manner.</p>
<p><span style="text-decoration: underline;">Software Prerequisites</span></p>
<p>The proxy connector is an application that needs to be installed on a Windows Server 2012 R2 or Windows 8.1 + machine. The application itself is a ~4 MB download and even can be installed on the server that you are trying to publish (although I would not recommend this).</p>
<p><span style="text-decoration: underline;">Network Requirements</span></p>
<p>The server that houses the proxy connector only requires <em>outbound</em> access. Specifically the following ports need to be open:</p>
<p><table border="1" width="772"></table></p>
<p><thead></thead></p>
<p><tr></tr></p>
<p><td width="110">PORT NUMBER</td></p>
<p><td width="660">DESCRIPTION</td><br><br></p>
<p><tbody></tbody></p>
<p><tr></tr></p>
<p><td width="110">80</td></p>
<p><td width="660">To enable outbound HTTP traffic for security validation.</td><br></p>
<p><tr></tr></p>
<p><td width="110">443</td></p>
<p><td width="660">To enable user authentication against Azure AD (required only for the Connector registration process)</td><br></p>
<p><tr></tr></p>
<p><td width="110">10100 - 10120</td></p>
<p><td width="660">To enable LOB HTTP responses sent back to the proxy</td><br></p>
<p><tr></tr></p>
<p><td width="110">9352, 5671</td></p>
<p><td width="660">To enable communication between the Connector toward the Azure service for incoming requests.</td><br></p>
<p><tr></tr></p>
<p><td width="110">9350</td></p>
<p><td width="660">Optional. To enable better performance for incoming requests.</td><br></p>
<p><tr></tr></p>
<p><td width="110">8080</td></p>
<p><td width="660">To enable the Connector bootstrap sequence and to enable Connector automatic update</td><br></p>
<p><tr></tr></p>
<p><td width="110">9090</td></p>
<p><td width="660">To enable Connector registration (required only for the Connector registration process)</td><br></p>
<p><tr></tr></p>
<p><td width="110">9091</td></p>
<p><td width="660">To enable Connector trust certificate automatic renewal</td><br><br><br><br><span style="text-decoration: underline;">How it works</span></p>
<p>The proxy connector makes an outbound connection to the Azure proxy in the cloud thus allowing a bi-directional TCP/IP transmission.  Before a user can access the internal web application, the user’s account is authenticated against Azure AD (pre-authentication). Afterwards, if Kerberos authentication is enabled for the applications, the users will experience a single-sign on experience. If not, the user needs to authenticate to the application.</p>
<p><span style="text-decoration: underline;">Publishing OWA</span></p>
<p>To test out the proxy, I’ve decided to publish Exchange 2010 OWA which is hosted in my lab without any external presence. My goal is to allow for a single sign on experience. I will need to do the following to meet this requirement:</p>
<p>1) Enable Kerberos authentication for Outlook Web App.</p>
<p>2) I need to ensure SPN’s and Kerberos Constrained Delegation is properly setup.</p>
<p><span style="text-decoration: underline;">Enable Kerberos Authentication for OWA</span></p>
<p>To do this, logon to the Exchange Management Shell (2010)—&gt;Server Configuration—&gt;Client Access</p>
<p>Go to the OWA virtual directory and edit the properties. Change the authentication method from forms-based authentication to “Integrated Windows Authentication”</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2015/12/image.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2015/12/image_thumb.png" alt="image" title="image"></a></p>
<p>Now we need to delegate the server that has the connector installed with the rights to request a Kerberos ticket on behalf of the Exchange server. To achieve this, go Active Directory Users and Computers, and double click on the computer that has the Azure connector installed.</p>
<p>Go to the delegation tab and add the services (HTTP) of the Exchange server that can be delegated.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2015/12/image7.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2015/12/image_thumb7.png" alt="image" title="image"></a></p>
<p><span style="text-decoration: underline;">Configure Azure AD Premium</span></p>
<p>Create a new application in Azure AD:</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2015/12/image8.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2015/12/image_thumb8.png" alt="image" title="image"></a></p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2015/12/image9.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2015/12/image_thumb9.png" alt="image" title="image"></a></p>
<p><strong>PreAuthentication Method: </strong>Set to Azure Active Directory.</p>
<p><strong>Translate URL In Headers</strong>: Set to No since Exchange needs host headers to be preserved.</p>
<p><strong>Internal Authentication Method</strong>: Set to Integrated Windows Authentication (Kerberos). If Kerberos is not possible, the user will have to login to the application.</p>
<p><strong>Internal Application SPN:</strong> Provide the SPN for the Exchange server.</p>
<p>&nbsp;</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2015/12/image4.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2015/12/image_thumb4.png" alt="image" title="image"></a></p>
<p>Now navigating to the Azure Application Proxy URL yields this:</p>
<p><a href="https://owapage-jenutest.msappproxy.net/OWA/" target="_blank" rel="external">https://owapage-jenutest.msappproxy.net/OWA/</a></p>
<p>Sign into the Azure Portal using your AD credentials (UPN and password).</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2015/12/image10.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2015/12/image_thumb10.png" alt="image" title="image"></a></p>
<p>Once successfully authenticated, you will be redirected to OWA page and logged in using Kerberos authentication.</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2015/12/image11.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2015/12/image_thumb11.png" alt="image" title="image"></a></p>
<p><span style="text-decoration: underline;">Recommendation:</span></p>
<p>Azure Application Proxy is a great tool to publish internal web applications securely. In most environments, publishing an application wouldn’t involve making changes to the firewall since the proxy connector only needs outbound access.</p>
<p>Any application published via Azure Application Proxy can be added to the Application Portal which the users can access from a single page; if they are logged in they would go directly to the OWA page without the need to be authenticated twice. To take this further, multi-factor authentication can be easily leveraged to add another layer of security. To provide a higher level of availability the connector can be installed on multiple machines. In the case one server is down, the application proxy would continue to work.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jenujose.github.io/2015/02/01/detachingattaching-sccm-2012-database/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jenu Jose">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes from the field...">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/02/01/detachingattaching-sccm-2012-database/" itemprop="url">Detaching/Attaching SCCM 2012 Database</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-02-01T03:03:35-06:00">
                2015-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Uncategorized/" itemprop="url" rel="index">
                    <span itemprop="name">Uncategorized</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/02/01/detachingattaching-sccm-2012-database/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/02/01/detachingattaching-sccm-2012-database/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>As part of a recent task to relocate an SCCM database to faster spindles, I went ahead used the detach/attach method to accomplish this. After the database relocation there were no issues until we tried to create a new application. I received the following error:</p>
<p><a href="http://blog.jenujose.com/wp-content/uploads/2015/02/image001.png" target="_blank" rel="external"><img src="http://blog.jenujose.com/wp-content/uploads/2015/02/image001.png" alt="image001"></a></p>
<p>&nbsp;</p>
<p>After checking the logs, I found the following event being reported continuously:</p>
<p><img src="http://blog.jenujose.com/wp-content/uploads/2015/02/unnamed.png" alt="unnamed"></p>
<p>After some digging around, I found a Microsoft KB that addresses this exact problem: <a href="http://support.microsoft.com/kb/2709082" title="http://support.microsoft.com/kb/2709082" target="_blank" rel="external">http://support.microsoft.com/kb/2709082</a></p>
<p>Part of the issue is that when you detach and attach a database ( a perfectly supported SQL action) the trustworthy database flag is turned to off. As a result, SCCM DLL’s are not successfully loaded. After following the steps outlined in the KB article, I was able to create applications without any issues.</p>
<p>Recommendation: Use backup/restore method to relocate the database than using attach/detach.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jenujose.github.io/2015/01/14/failed-resolve-select-task-sequence/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jenu Jose">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes from the field...">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/01/14/failed-resolve-select-task-sequence/" itemprop="url">Failed to Resolve Select Task Sequence...</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-01-14T15:37:47-06:00">
                2015-01-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SCCM/" itemprop="url" rel="index">
                    <span itemprop="name">SCCM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/01/14/failed-resolve-select-task-sequence/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/01/14/failed-resolve-select-task-sequence/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>I was working at a client with SCCM 2012 R2 OSD configuration and I was getting the error “Failed to Resolve Select Task Sequence Dependencies” every time testing the task sequence. I checked for the usual suspects and ensured that all applications and packages were distributed to the Distribution Points.</p>
<p>Initially, I thought the application that was causing the error was corrupted. So I went ahead and refreshed the content (“Update Content” as it’s formally known”). I attempted to run the task sequence again and then noticed that the same error came up referencing a different application. I began to see a pattern and all the applications that were referenced in the error all had version 1.</p>
<p>To increment all application versions, I used the following script that I pieced together from other sources:</p>
<p><pre class="lang:ps decode:true" title="UpdateDP">Import-Module ‘C:\Program Files (x86)\Microsoft Configuration Manager\bin\ConfigurationManager.psd1’<br>CD SiteCode:<br>$applications=Get-CMApplication |Select-Object ApplicationName,LocalizedDisplayName, CIVersion |Where-Object CIVersion -eq “1”<br>foreach ($app in $applications)<br>{<br>$app=$app.LocalizedDisplayName<br>Write-host “Application :” “$app” -ForegroundColor DarkCyan</pre></p>
<p>$dpttypes=Get-CMDeploymentType -ApplicationName $app</p>
<p>foreach ($dpt in $dpttypes)<br>{<br>$dptname=$dpt.LocalizedDisplayName<br>Write-Host “Deployment Type:” “$dptname” -ForegroundColor DarkGreen<br>Update-CMDistributionPoint -ApplicationName $app -DeploymentTypeName $dptname<br>}<br>}<br>Note: Even after changing all versions to 2, I still had one or two apps needed to be incremented before I could proceed with the TS.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jenujose.github.io/2015/01/02/a-read-operation-on-a-large-object-failed/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jenu Jose">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes from the field...">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/01/02/a-read-operation-on-a-large-object-failed/" itemprop="url">A read operation on a large object failed..</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-01-02T20:00:47-06:00">
                2015-01-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SCCM/" itemprop="url" rel="index">
                    <span itemprop="name">SCCM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/01/02/a-read-operation-on-a-large-object-failed/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/01/02/a-read-operation-on-a-large-object-failed/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>After logging into my SCCM 2012 R2 server and running a report, I was getting an error to check network connectivity to the Report Server. After logging into my SQL 2012 SP2 server, I saw the following error message every time I ran a report:</p>
<p><em>Log Name: Application<br>Source: MSSQLSERVER<br>Date: 12/5/2014 10:32:42 PM<br>Event ID: 7886<br>Task Category: Server<br>Level: Error<br>Keywords: Classic
</em><br><strong>Description</strong>:<br><em>A read operation on a large object failed while sending data to the client. A common cause for this is if the application is running in READ UNCOMMITTED isolation level. This connection will be terminated.
</em><br>I checked the database size and initially thought the autogrowth threshold was low. I was still getting the error after adjusting the autogrowth so I then thought it might be an issue with the database itself and ran a DB check.</p>
<p><pre class="lang:default decode:true" title="DBCheck SQL">ALTER DATABASE ReportServerDB SET SINGLE_USER WITH ROLLBACK IMMEDIATE;<br>BEGIN TRANSACTION;<br>DBCC CHECKDB (‘ReportServerDB’, REPAIR_ALLOW_DATA_LOSS);<br>ALTER DATABASE ReportServerDB SET MULTI_USER;</pre><br>I had to run these commands couple of times to fix the corruption in the database.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Jenu Jose</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="mailto:yourname@gmail.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://twitter.com/jenu" target="_blank" title="Twitter">
                    
                      <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jenu Jose</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  

    
      <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>
    

    

  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
